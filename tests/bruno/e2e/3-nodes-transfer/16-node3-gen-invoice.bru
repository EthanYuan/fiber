meta {
  name: generate a invoice
  type: http
  seq: 16
}

post {
  url: {{NODE3_RPC_URL}}
  body: json
  auth: none
}

headers {
  Content-Type: application/json
  Accept: application/json
}

body:json {
  {
    "id": "42",
    "jsonrpc": "2.0",
    "method": "new_invoice",
    "params": [
      {
        "amount": 36100000000,
        "currency": "Ckb",
        "description": "test invoice generated by node3",
        "expiry": 3600,
        "final_cltv": 40,
        "payment_preimage": "0x0000000000000000000000000000000000000000000000000000000000000002"
      }
    ]
  }
}

assert {
  res.body.error: isUndefined
  res.body.result: isDefined
}

script:post-response {
  // Sleep for sometime to make sure current operation finishes before next request starts.
  await new Promise(r => setTimeout(r, 100));
  console.log("generated result: ", res.body.result);
  // TODO refactor invoice rpc to return json object
  bru.setVar("payment_hash", "0x8b44862e7857529d0be8b24031d3562541ee4baedc081aa5c54cbc62f8ff3f65");
  bru.setVar("payment_amount", "0x867ba4900");
}
