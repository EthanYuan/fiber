meta {
  name: generate a invoice
  type: http
  seq: 07
}

post {
  url: {{NODE2_RPC_URL}}/invoice
  body: json
  auth: none
}

headers {
  Content-Type: application/json
  Accept: application/json
}

body:json {
    {
        "request": {
            "NewInvoice": {
                "amount": 200,
                "currency": "Ckb",
                "description": "test invoice generated by node2",
                "expiry": 3600,
                "final_cltv": 40,
                "payment_preimage": "0x0000000000000000000000000000000000000000000000000000000000000002"
            }
        }
    }
}

assert {
  res.status: eq 200
}

script:post-response {
  // Sleep for sometime to make sure current operation finishes before next request starts.
  await new Promise(r => setTimeout(r, 100));
  bru.setVar("payment_hash", res.body.payment_hash);
  bru.setVar("payment_amount", res.body.invoice.amount);
  console.log("generate invoice: ", res.body.encode_payment);
  console.log("generated result: ", res.body);
}
